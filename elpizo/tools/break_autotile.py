from PIL import Image
import sys
import os

TEXCOORDS = [
    [13, 14, 17, 18],
    [ 2, 14, 17, 18],
    [13,  3, 17, 18],
    [ 2,  3, 17, 18],
    [13, 14, 17,  7],
    [ 2, 14, 17,  7],
    [13,  3, 17,  7],
    [ 2,  3, 17,  7],
    [13, 14,  6, 18],
    [ 2, 14,  6, 18],
    [13,  3,  6, 18],
    [ 2,  3,  6, 18],
    [13, 14,  6,  7],
    [ 2, 14,  6,  7],
    [13,  3,  6,  7],
    [ 2,  3,  6,  7],
    [12, 14, 16, 18],
    [12,  3, 16, 18],
    [12, 14, 16,  7],
    [12,  3, 16,  7],
    [ 9, 10, 17, 18],
    [ 9, 10, 17,  7],
    [ 9, 10,  6, 18],
    [ 9, 10,  6,  7],
    [13, 15, 17, 19],
    [13, 15,  6, 19],
    [ 2, 15, 17, 19],
    [ 2, 15,  6, 19],
    [13, 14, 21, 22],
    [ 2, 14, 21, 22],
    [13,  3, 21, 22],
    [ 2,  3, 21, 22],
    [12, 15, 16, 19],
    [ 9, 10, 21, 22],
    [ 8,  9, 12, 13],
    [ 8,  9, 12,  7],
    [10, 11, 14, 15],
    [10, 11,  6, 15],
    [18, 19, 22, 23],
    [ 2, 19, 22, 23],
    [16, 17, 20, 21],
    [16,  3, 20, 21],
    [ 8, 11, 12, 15],
    [ 8,  9, 20, 21],
    [16, 19, 20, 23],
    [10, 11, 22, 23],
    [ 8, 11, 20, 23],
    [ 0,  1,  4,  5]
]


def main():
  autotile = Image.open(sys.argv[1])

  for row, texcoord in enumerate(TEXCOORDS):
    broken = Image.new("RGBA", (32, 32))

    for index, c in enumerate(texcoord):
      dest_x = (index % 2) * 16
      dest_y = (index // 2) * 16

      src_x = (c % 4) * 16
      src_y = (c // 4) * 16

      broken.paste(autotile.crop((src_x, src_y, src_x + 16, src_y + 16)),
                                 (dest_x, dest_y))

    broken.save(os.path.join(sys.argv[2], "broken_{:02}.png".format(row)))


if __name__ == "__main__":
  main()
